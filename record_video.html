<!DOCTYPE HTML>

<html>
<head>
    <link href="//vjs.zencdn.net/5.11/video-js.min.css" rel="stylesheet">
    <script src="//vjs.zencdn.net/5.11/video.min.js"></script>
    <script src="RecordRTC/RecordRTC.js"></script>
    <script src="videojs-record/src/js/videojs.record.js"></script>
    <script src="fine-uploader/fine-uploader.js"></script>
    <link href="videojs-record/src/css/videojs.record.css" rel="stylesheet">
</head>
<body>
    <video id="myVideo" class="video-js vjs-default-skin"></video>

    <script>

console.log(window.url_record);

var uploader = new qq.FineUploaderBasic({
            debug: true,
            request: {
                endpoint: window.url_record
            },
            validation: {
                allowedExtensions: ['video/webm']
            }
        });


var player = videojs("myVideo",
{
    controls: true,
    width: 320,
    height: 240,
    controlBar: {
        volumeMenuButton: false
    },
    plugins: {
        record: {
            audio: false,
            video: true,
            maxLength: 2000,
            debug: true
        }
    }
});
// error handling
player.on('deviceError', function()
{
    console.warn('device error:', player.deviceErrorCode);
});
player.on('error', function(error)
{
    console.log('error:', error);
});
// user clicked the record button and started recording
player.on('startRecord', function()
{
    console.log('started recording!');
});
// user completed recording and stream is available
player.on('finishRecord', function()
{
    // the blob object contains the recorded data that
    // can be downloaded by the user, stored on server etc.
    //console.log('finished recording: ', player.recordedData);

    //var url = window.url_record + '?data=' + player.recordedData;

    //var newWin = window.open(url,'windowName','height=800,width=800', 'scrollbars=yes', 'ff=f');            

    console.log(player.recordedData);

    var file = player.recordedData;
    var filesList = [file];
    uploader.addFiles(filesList);



    //player.recorder.saveAs({'video': 'my-video-file-name'});
});

window.onbeforeunload = function()
{
    //alert("confirm exit is being called");
    player.recorder.stop();
    //player.recorder.saveAs({'video': 'my-video-file-name'});

    

    
    //return false;

    //player.recorder.saveAs({'video': 'my-video-file-name'});
}

</script>
</body>
</html>